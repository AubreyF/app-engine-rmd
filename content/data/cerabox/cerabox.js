var CeraBox=new Class({Implements:[Options],loaderTimer:null,timeOuter:null,vars:{items:new Array,cerabox:null,windowOpen:false,busy:false,currentIndex:[0,0]},options:{group:true,errorLoadingMessage:"The requested content cannot be loaded. Please try again later.",events:{onClose:function(){},onOpen:function(){},onChange:function(){},_onClose:null,_onOpen:null,_onChange:null}},initialize:function(e){this.setOptions(e);this.initHTML();if(Browser.ie6)$("cerabox-loading").addClass("ceraboxbox-ie6");window.addEvent("resize",this._resize.bind(this));$("cerabox-loading").addEvent("click",function(e){e.stop();this.close()}.bind(this));document.addEvent("keyup",function(e){if(e.key=="esc")this.close();if(e.target.get("tag")=="input"||e.target.get("tag")=="select"||e.target.get("tag")=="textarea")return;if(e.key=="left")this.vars.cerabox.getElement(".cerabox-left").fireEvent("click",e);if(e.key=="right")this.vars.cerabox.getElement(".cerabox-right").fireEvent("click",e)}.bind(this))},addItems:function(e,t){var n=$$(e);if(n.length<1)throw"Empty container";var r=this.vars.items.length;this.vars.items[r]=[];t=t?t:{width:Math.min(Math.max(1010,window.innerWidth-50),1500),height:750,displayTitle:false};Array.each(n,function(e,n){if(t.group===false||t.group!==true&&this.options.group===false){this.vars.items[r]=[];this.vars.items[r][0]=e;n=[r,0];r=r+1}else{this.vars.items[r][n]=e;n=[r,n]}if(typeof t.ajax!="undefined"){e.addEvent("click",function(e){e.preventDefault();if(this.vars.busy)return;this.vars.busy=true;this._addCallbacks(typeof t.events!="undefined"?t.events:null);this.vars.cerabox.setStyle("cursor","auto").removeEvents("click");if(true===t.clickToClose)this.vars.cerabox.setStyle("cursor","pointer").addEvent("click",function(e){e.stop();this.close()}.bind(this));this._showInit();this.showAjax(n,t)}.bind(this))}else if(e.get("href").replace(/(\?.*)/,"").test(/\.jpg|jpeg|png|gif$/i)){e.addEvent("click",function(e){e.preventDefault();if(this.vars.busy)return;this.vars.busy=true;this._addCallbacks(typeof t.events!="undefined"?t.events:null);this.vars.cerabox.setStyle("cursor","auto").removeEvents("click");if(true===t.clickToClose)this.vars.cerabox.setStyle("cursor","pointer").addEvent("click",function(e){e.stop();this.close()}.bind(this));this._showInit();this.showImage(n,t)}.bind(this))}else if(e.get("href").test(/\.swf$/i)){e.addEvent("click",function(e){e.preventDefault();if(this.vars.busy)return;this.vars.busy=true;this._addCallbacks(typeof t.events!="undefined"?t.events:null);this.vars.cerabox.setStyle("cursor","auto").removeEvents("click");if(true===t.clickToClose)this.vars.cerabox.setStyle("cursor","pointer").addEvent("click",function(e){e.stop();this.close()}.bind(this));this._showInit();this.showSwf(n,t)}.bind(this))}else{e.addEvent("click",function(e){e.preventDefault();if(this.vars.busy)return;this.vars.busy=true;this._addCallbacks(typeof t.events!="undefined"?t.events:null);this.vars.cerabox.setStyle("cursor","auto").removeEvents("click");if(true===t.clickToClose)this.vars.cerabox.setStyle("cursor","pointer").addEvent("click",function(e){e.stop();this.close()}.bind(this));this._showInit();this.showIframe(n,t)}.bind(this))}}.bind(this))},showAjax:function(e,t){var n=this;var r=this.vars.items[e[0]];var i=r[e[1]];this.loaderTimer=this._displayLoader.delay(200,this);var s=(new Request.HTML({url:i.get("href"),method:t.ajax.method?t.ajax.method:"post",data:t.ajax.data?t.ajax.data:"",onSuccess:function(s){if(false===n.vars.busy)return;clearInterval(n.loaderTimer);$("cerabox-loading").setStyle("display","none");if(false!==t.displayOverlay)n._displayOverlay();var o=n.vars.cerabox.getElement("#cerabox-ajaxPreLoader").empty().adopt(s);n.vars.cerabox.setStyle("display","block");o.setStyle("width",t.width?t.width:o.getScrollSize().x+"px");o.setStyle("height",t.height?t.height:o.getScrollSize().y+"px");var u=n._getSizeElement(o,true===t.fullSize?true:false);o=o.get("html");n.vars.cerabox.getElement("#cerabox-ajaxPreLoader").empty().setStyles({width:0,height:0});n.vars.cerabox.getElement(".cerabox-title span").setStyle("display","none").empty();if(n.vars.windowOpen==true){n._transformItem(u.width,u.height)}n.vars.cerabox.getElement(".cerabox-content").set("tween",{duration:300}).tween("opacity","0").get("tween").addEvent("complete",function(){this.removeEvents("complete");if(false===n.vars.busy)return;if(false!==t.displayTitle)n.vars.cerabox.getElement(".cerabox-title span").setStyle("display","block").set("text",(r.length>1?"Item "+(e[1]+1)+" / "+r.length+" ":"")+(i.get("title")?i.get("title"):""));n.vars.cerabox.getElement(".cerabox-content").empty().set("opacity",0).set("html",o).set("tween",{duration:100}).tween("opacity","1");if(r.length>1)n._addNavButtons(e);n._openWindow(u.width,u.height,t.animation?t.animation:"fade",e);if(true===t.fullSize)n._resize();n.vars.busy=false})},onTimeout:function(){n._timedOut(e,t)},onFailure:function(){n._timedOut(e,t)},onException:function(){n._timedOut(e,t)}})).send()},showImage:function(e,t){var n=this;var r=this.vars.items[e[0]];var i=r[e[1]];this.loaderTimer=this._displayLoader.delay(200,this);var s=new Asset.image(i.get("href"),{onload:function(){if(false===n.vars.busy)return;clearInterval(n.loaderTimer);$("cerabox-loading").setStyle("display","none");if(false!==t.displayOverlay)n._displayOverlay();this.set("width",t.width?t.width:this.get("width"));this.set("height",t.height?t.height:this.get("height"));var o=n._getSizeElement(this,true===t.fullSize?true:false);n.vars.cerabox.getElement(".cerabox-title span").setStyle("display","none").empty();if(n.vars.windowOpen==true){n._transformItem(o.width,o.height)}n.vars.cerabox.getElement(".cerabox-content").set("tween",{duration:300}).tween("opacity","0").get("tween").addEvent("complete",function(){this.removeEvents("complete");if(false===n.vars.busy)return;if(false!==t.displayTitle)n.vars.cerabox.getElement(".cerabox-title span").setStyle("display","block").set("text",(r.length>1?"Item "+(e[1]+1)+" / "+r.length+" ":"")+(i.get("title")?i.get("title"):""));n.vars.cerabox.getElement(".cerabox-content").empty().set("opacity",0).adopt(s).set("tween",{duration:100}).tween("opacity","1");if(r.length>1)n._addNavButtons(e);n._openWindow(o.width,o.height,t.animation?t.animation:"fade",e);if(true===t.fullSize)n._resize();n.vars.busy=false})},onerror:function(){n._timedOut(e,t)}})},showSwf:function(e,t){this.vars.busy=true;var n=this;var r=this.vars.items[e[0]];var i=r[e[1]];n.vars.cerabox.getElement(".cerabox-title span").setStyle("display","none").empty();var s={width:t.width?t.width:500,height:t.height?t.height:400};var o=new Swiff(i.get("href"),{width:s.width,height:s.height,params:{wMode:"opaque"}});if(false!==t.displayOverlay)n._displayOverlay();if(n.vars.windowOpen==true){n._transformItem(s.width,s.height)}n.vars.cerabox.getElement(".cerabox-content").set("tween",{duration:300}).tween("opacity","0").get("tween").addEvent("complete",function(){this.removeEvents("complete");if(false===n.vars.busy)return;if(false!==t.displayTitle)n.vars.cerabox.getElement(".cerabox-title span").setStyle("display","block").set("text",(r.length>1?"Item "+(e[1]+1)+" / "+r.length+" ":"")+(i.get("title")?i.get("title"):""));n.vars.cerabox.getElement(".cerabox-content").empty().set("opacity",0).adopt(o).set("tween",{duration:100}).tween("opacity","1");if(r.length>1)n._addNavButtons(e);n._openWindow(s.width,s.height,t.animation?t.animation:"fade",e);if(true===t.fullSize)n._resize();n.vars.busy=false})},showIframe:function(e,t){var n=this;var r=this.vars.items[e[0]];var i=r[e[1]];this.loaderTimer=this._displayLoader.delay(200,this);this.timeOuter=this._timedOut.delay(1e4,this,[e,t]);var s=new IFrame({src:i.get("href"),events:{domready:function(){n.vars.busy=true;clearInterval(n.timeOuter);clearInterval(n.loaderTimer);$("cerabox-loading").setStyle("display","none");if(false!==t.displayOverlay)n._displayOverlay();this.setStyles({width:t.width?t.width:"1px",height:t.height?t.height:"1px",border:"0"});var i=n._getSizeElement(this,true===t.fullSize?true:false);if(r.length>1)n._addNavButtons(e);n.vars.cerabox.getElement(".cerabox-title span").setStyle("display","none").empty();if(n.vars.windowOpen==true){n._transformItem(i.width,i.height)}n._openWindow(i.width,i.height,t.animation?t.animation:"fade",e);if(true===t.fullSize)n._resize();n.vars.cerabox.getElement(".cerabox-content").set("tween",{duration:500}).tween("opacity","1");n.vars.busy=false},load:function(){this.setStyle("visibility","visible")}}});s.set("border","0");s.set("frameborder","0");this.vars.cerabox.setStyle("display","block").getElement(".cerabox-content").empty().set("opacity",0).adopt(s)},close:function(){this.vars.busy=true;clearInterval(this.timeOuter);clearInterval(this.loaderTimer);$("cerabox-loading").setStyle("display","none");var e=this;e.vars.cerabox.set("tween",{duration:50}).tween("opacity","0").get("tween").addEvent("complete",function(){this.removeEvents("complete");this.element.setStyle("display","none");$("cerabox-background").set("tween",{duration:150,link:"chain"}).tween("opacity","0").tween("display","none");e.vars.cerabox.getElement(".cerabox-content").empty();e.vars.cerabox.getElement(".cerabox-left").removeEvents("click").setStyle("display","none");e.vars.cerabox.getElement(".cerabox-right").removeEvents("click").setStyle("display","none");var t=e.vars.items[e.vars.currentIndex[0]];var n=t[e.vars.currentIndex[1]];if(e.vars.windowOpen){if(null!==e.options.events._onClose)e.options.events._onClose.call(e,n,t);else e.options.events.onClose.call(e,n,t)}e.vars.windowOpen=false;e.vars.busy=false})},initHTML:function(){var e=$(document.body);e.adopt([(new Element("div",{id:"cerabox-loading"})).adopt(new Element("div")),new Element("div",{id:"cerabox-background",styles:{height:e.getScrollSize().y+"px"},events:{click:function(e){e.stop();this.close()}.bind(this)}}),this.vars.cerabox=(new Element("div",{id:"cerabox"})).adopt([new Element("div",{"class":"cerabox-content"}),(new Element("div",{"class":"cerabox-title"})).adopt(new Element("span")),new Element("a",{"class":"cerabox-close",events:{click:function(e){e.stop();this.close()}.bind(this)}}),(new Element("a",{"class":"cerabox-left"})).adopt(new Element("span")),(new Element("a",{"class":"cerabox-right"})).adopt(new Element("span")),new Element("div",{id:"cerabox-ajaxPreLoader",styles:{"float":"left",overflow:"hidden",display:"block"}})])])},_timedOut:function(e,t){this.vars.busy=true;clearInterval(this.loaderTimer);$("cerabox-loading").setStyle("display","none");this._displayOverlay();this.vars.cerabox.getElement(".cerabox-title span").setStyle("display","none").empty();var n=this;var r=this.vars.items[e[0]];this.vars.cerabox.getElement(".cerabox-content").set("tween",{duration:300}).tween("opacity","0").get("tween").addEvent("complete",function(){this.removeEvents("complete");if(false===n.vars.busy)return;n.vars.cerabox.getElement(".cerabox-content").empty().set("opacity",0).adopt(new Element("span",{text:n.options.errorLoadingMessage})).set("tween",{duration:100}).tween("opacity","1");if(r.length>1)n._addNavButtons(e);n._openWindow(250,50,t.animation?t.animation:"fade",e);n.vars.busy=false});if(n.vars.windowOpen==true){n._transformItem(250,50)}},_addNavButtons:function(e){var t=this;this.vars.cerabox.getElement(".cerabox-left").removeEvents("click").setStyle("display","none");this.vars.cerabox.getElement(".cerabox-right").removeEvents("click").setStyle("display","none");if(this.vars.items[e[0]][e[1]-1]){this.vars.cerabox.getElement(".cerabox-left").setStyle("display","block").addEvent("click",function(n){n.stopPropagation();this.setStyle("display","none");t.vars.items[e[0]][e[1]-1].fireEvent("click",n)})}if(this.vars.items[e[0]][e[1]+1]){this.vars.cerabox.getElement(".cerabox-right").setStyle("display","block").addEvent("click",clickFnc=function(n){n.stopPropagation();this.setStyle("display","none");t.vars.items[e[0]][e[1]+1].fireEvent("click",n)})}},_transformItem:function(e,t){var n={display:"block",width:e,height:t,opacity:1};if(window.getSize().x>this.vars.cerabox.getSize().x+40&&window.getSize().x>e+40){this.vars.cerabox.setStyles({left:"50%",right:"auto"});n["margin-left"]=-e/2+$(document.body).getScroll().x+"px"}else{this.vars.cerabox.setStyles({"margin-left":"0",left:"auto",right:"20px"})}if(window.getSize().y>this.vars.cerabox.getSize().y+40&&window.getSize().y>t+40){this.vars.cerabox.setStyles({top:"50%"});n["margin-top"]=-t/2+$(document.body).getScroll().y+"px"}else{if(t+40>$(document.body).getScrollSize().y-$(document.body).getScroll().y){this.vars.cerabox.setStyles({"margin-top":"0",top:($(document.body).getScrollSize().y-(t+60)>20?$(document.body).getScrollSize().y-(t+60):20)+"px"})}else{this.vars.cerabox.setStyles({"margin-top":"0",top:$(document.body).getScroll().y+20+"px"})}}return this.vars.cerabox.set("morph",{duration:150}).morph(n).get("morph")},_showInit:function(){clearInterval(this.timeOuter);clearInterval(this.loaderTimer);$("cerabox-loading").setStyle("display","none")},_openWindow:function(e,t,n,r){if(this.vars.cerabox.getElement(".cerabox-content iframe"))this.vars.cerabox.getElement(".cerabox-content iframe").setStyles({width:e,height:t});this.vars.currentIndex=r;var i=this.vars.items[r[0]][r[1]];if(this.vars.windowOpen==true){if(null!==this.options.events._onChange)this.options.events._onChange.call(this,i,this.vars.items[r[0]]);else this.options.events.onChange.call(this,i,this.vars.items[r[0]]);return}switch(n){case"ease":this.vars.cerabox.setStyles({display:"block",left:i.getPosition().x+"px",top:i.getPosition().y+"px",width:i.getSize().x+"px",height:i.getSize().y+"px",margin:0,opacity:0}).set("morph",{duration:200}).morph({left:window.getSize().x/2+"px",top:window.getSize().y/2+"px",width:e,height:t,"margin-left":-e/2+$(document.body).getScroll().x+"px","margin-top":-t/2+$(document.body).getScroll().y+"px",opacity:"1"});break;case"fade":default:this.vars.cerabox.setStyles({display:"block",left:"50%",top:"50%",width:e,height:t,opacity:0,"margin-left":-e/2+$(document.body).getScroll().x+"px","margin-top":-t/2+$(document.body).getScroll().y+"px"}).set("tween",{duration:150}).tween("opacity","1");break}if(null!==this.options.events._onOpen)this.options.events._onOpen.call(this,i,this.vars.items[r[0]]);else this.options.events.onOpen.call(this,i,this.vars.items[r[0]]);i.blur();this.vars.windowOpen=true},_displayOverlay:function(){$("cerabox-background").setStyles({display:"block",opacity:".95",height:$(document.body).getScrollSize().y+"px",width:$(document.body).getScrollSize().x+"px"})},_displayLoader:function(){$("cerabox-loading").setStyle("display","block");this._loaderAnimation()},_loaderAnimation:function(e){if(!e)e=0;$("cerabox-loading").getElement("div").setStyle("top",e*-40+"px");e=(e+1)%12;if($("cerabox-loading").getStyle("display")!="none")this._loaderAnimation.delay(60,this,e)},_getSizeElement:function(e,t){return{width:Math.min(Math.max(1010,window.innerWidth-50),1500),height:750};var n=0,r=0;if(e.tagName=="IFRAME"){try{n=e.get("width")?this._sizeStringToInt(e.get("width"),"x"):e.getStyle("width").toInt()>1?this._sizeStringToInt(e.getStyle("width"),"x"):e.contentWindow.document.getScrollWidth()?e.contentWindow.document.getScrollWidth():window.getSize().x*.75}catch(i){n=window.getSize().x*.75;this._log(i)}try{r=e.get("height")?this._sizeStringToInt(e.get("height"),"y"):e.getStyle("height").toInt()>1?this._sizeStringToInt(e.getStyle("height"),"y"):e.contentWindow.document.getScrollHeight()?e.contentWindow.document.getScrollHeight():window.getSize().y*.75}catch(i){r=window.getSize().y*.75;this._log(i)}if(Browser.ie){r=r+20}if(false===t){if(window.getSize().y-100<r){n=n+(Browser.Platform.mac?15:17)}return{width:window.getSize().x-50<n?window.getSize().x-50:n,height:window.getSize().y-100<r?window.getSize().y-100:r}}else return{width:n,height:r}}n=e.get("width")?this._sizeStringToInt(e.get("width"),"x"):e.getStyle("width")&&e.getStyle("width")!="auto"?this._sizeStringToInt(e.getStyle("width"),"x"):window.getSize().x-50;r=e.get("height")?this._sizeStringToInt(e.get("height"),"y"):e.getStyle("height")&&e.getStyle("height")!="auto"?this._sizeStringToInt(e.getStyle("height"),"y"):window.getSize().y-100;if(false===t){var s=Math.min(Math.min(window.getSize().x-50,n)/n,Math.min(window.getSize().y-100,r)/r);return{width:Math.round(s*n),height:Math.round(s*r)}}else return{width:n,height:r}},_sizeStringToInt:function(e,t){return typeof e=="string"&&e.test("%")?window.getSize()[t]*(e.toInt()/100):e.toInt()},_resize:function(){if(this.vars.windowOpen==true){if(window.getSize().x>this.vars.cerabox.getSize().x+40){this.vars.cerabox.setStyles({"margin-left":(this.vars.cerabox.getSize().x>0?-this.vars.cerabox.getSize().x/2+$(document.body).getScroll().x:0)+"px",left:"50%",right:"auto"})}else{this.vars.cerabox.setStyles({"margin-left":"0",left:"auto",right:"20px"})}if(window.getSize().y>this.vars.cerabox.getSize().y+40){this.vars.cerabox.setStyles({"margin-top":(this.vars.cerabox.getSize().y>0?-this.vars.cerabox.getSize().y/2+$(document.body).getScroll().y:0)+"px",top:"50%",bottom:"auto"})}else{if(this.vars.cerabox.getSize().y+40>$(document.body).getScrollSize().y-$(document.body).getScroll().y){this.vars.cerabox.setStyles({"margin-top":"0",top:($(document.body).getScrollSize().y-(this.vars.cerabox.getSize().y+60)>20?$(document.body).getScrollSize().y-(this.vars.cerabox.getSize().y+60):20)+"px"})}else{this.vars.cerabox.setStyles({"margin-top":"0",top:$(document.body).getScroll().y+20+"px"})}}$("cerabox-background").setStyles({height:$(document.body).getScrollSize().y+"px",width:$(document.body).getScrollSize().x+"px"})}},_addCallbacks:function(e){this.options.events._onClose=null;this.options.events._onOpen=null;this.options.events._onChange=null;if(null!==e){if(typeof e.onClose=="function")this.options.events._onClose=e.onClose;if(typeof e.onOpen=="function")this.options.events._onOpen=e.onOpen;if(typeof e.onChange=="function")this.options.events._onChange=e.onChange}},_log:function(e,t){try{console.log(e)}catch(n){if(t)alert(e)}}})